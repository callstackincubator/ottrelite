import CommonDirectiveDoc from './__common-directive.mdx';

## The autoinstrumentation directive

<CommonDirectiveDoc />

## Class components

> [!NOTE]
> As seen in the examples below, the components include an explicit implementation of `shouldComponentUpdate` to prevent unnecessary re-renders. This is a common practice in React to optimize performance, but it is not compulsory - the instrumentation would still work without it. However, in such case, it would be expected that most likely the instrumentation would produce many entries, for invocations of the component which didn't actually result in an update to the shadow tree.

```typescript
import _ from 'lodash';
import { Component } from 'react';

export class TracedClassComponent extends Component<ExternallyDrivenComponentProps> {
  render() {
    'use trace';

    ...

    return (
      ...
    );
  }

  shouldComponentUpdate(
    nextProps: Readonly<ExternallyDrivenComponentProps>,
    nextState: Readonly<{}>,
    nextContext: any
  ): boolean {
    // only rerender if props have changed
    return (
      !_.isEqual(this.props, nextProps) ||
      !_.isEqual(this.state, nextState) ||
      !_.isEqual(this.context, nextContext)
    );
  }
}
```

> [!WARNING]
> The name of the tracer is used to create a unique OTEL tracer, so make sure it is unique across your application.

With an explicit Tracer name:

```typescript
import _ from 'lodash';
import { Component } from 'react';

export class TracedClassComponent extends Component<ExternallyDrivenComponentProps> {
  render() {
    'use trace dev TestLibTracedClassComponent';

    ...

    return (
      ...
    );
  }

  shouldComponentUpdate(
    nextProps: Readonly<ExternallyDrivenComponentProps>,
    nextState: Readonly<{}>,
    nextContext: any
  ): boolean {
    // only rerender if props have changed
    return (
      !_.isEqual(this.props, nextProps) ||
      !_.isEqual(this.state, nextState) ||
      !_.isEqual(this.context, nextContext)
    );
  }
}
```

### What will be the name of the tracer?

The following is an in-order (by priority) list of how the name of the tracer is determined:

| Declaration style                                   | Name                                     |
| --------------------------------------------------- | ---------------------------------------- |
| _Explicit name from the string after `"use trace"`_ | The passed string                        |
| component with `displayName` or `name`              | `displayName` or `name` property         |
| named class                                         | Name of the class                        |
| anonymous class                                     | Name of the assignment target identifier |
